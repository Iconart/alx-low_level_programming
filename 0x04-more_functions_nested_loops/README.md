more function nested loop to deal with
